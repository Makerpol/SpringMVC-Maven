<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.makerpol.dao.FileMapper">
	<resultMap type="com.makerpol.entity.PDF" id="fileResultMap">
		<id column="id" property="id" jdbcType="INTEGER"/>
		<result column="path" property="path" jdbcType="VARCHAR"/>
		<result column="filename" property="filename" jdbcType="VARCHAR"/>
		<result column="type" property="type" jdbcType="INTEGER"/>
		<result column="userid" property="userid" jdbcType="INTEGER"/>
		<result column="date" property="date" jdbcType="VARCHAR"/>
		<result column="icon" property="icon" jdbcType="VARCHAR"/>
		<result column="summary" property="summary" jdbcType="VARCHAR"/>
		<result column="clickcount" property="clickcount" jdbcType="INTEGER"/>
	</resultMap>
	
	<select id="getAllFiles" resultType="list" resultMap="fileResultMap" parameterType="int">
		<![CDATA[         
              select * from tb_file limit #{0},#{1}
         ]]> 
	</select>
	
	<select id="getCount" resultType="int" parameterType="string">
		select count(id) from tb_file 
		<trim prefix="where" prefixOverrides='add||or'>
			<if test="_parameter != null">
				add filename like concat('%',#{0},'%')
			</if>
		</trim>
	</select>
	
	<select id="getFileById" parameterType="int"  resultMap="fileResultMap">    
         <![CDATA[        
             select * from tb_file where id = #{id}    
         ]]>    
	</select>  
	
	<select id="getFileByName" parameterType="string"  resultMap="fileResultMap">         
         select * from tb_file where filename = #{filename}        
	</select>
	
	<select id="getFileList" parameterType="string" resultType="list"  resultMap="fileResultMap">         
         select * from
           (select * from tb_file where filename like concat('%',#{0},'%'))
         as u
         limit #{1},#{2}
	</select>
	
	<update id="updataFile" parameterType="com.makerpol.entity.PDF">
		update tb_file 
		<set>
		<if test="filename != null">filename = #{filename,jdbcType=VARCHAR},</if>   
		<if test="path != null">path = #{path,jdbcType=VARCHAR},</if>   
        <if test="date != null">date = #{date,jdbcType=VARCHAR},</if>
        <if test="type != null">type = #{type,jdbcType=INTEGER},</if>
        <if test="userid != null">userid = #{userid,jdbcType=INTEGER,}</if>
        <if test="icon != null">icon = #{icon,jdbcType=VARCHAR},</if>
        <if test="summary != null">summary = #{summary,jdbcType=VARCHAR},</if>
        <if test="clickcount != null">clickcount = #{clickcount,jdbcType=INTEGER},</if>
		</set>
        
        where id = #{id} 
   </update>
   
   <insert id="addFile" useGeneratedKeys="true" keyProperty="id" parameterType="com.makerpol.entity.PDF">   
         insert into tb_file(filename,path, date, type, userid, icon, summary, clickcount)   
         values(#{filename},#{path}, #{date}, #{type}, #{userid},#{icon},#{summary},#{clickcount})   
   </insert>
   
   <delete id="deleteFile" parameterType="int">
        delete from tb_file where id = #{id} 
   </delete>

</mapper>